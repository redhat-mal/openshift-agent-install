---
apiVersion: v1alpha1
kind: AgentConfig
metadata:
  name: {{ cluster_name }}
rendezvousIP: {{ rendezvous_ip }}
#bootArtifactsBaseURL: http://user-specified-infra.com
{% if ntp_servers is defined %}
additionalNTPSources:
{% for ntp_server in ntp_servers %}
  - {{ ntp_server }}
{% endfor %}
{% endif %}
hosts:
{% for node in nodes %}
  - hostname: {{ node.hostname }}
    role: {{ node.role | default('master') }}
    interfaces:
{% for interface in node.interfaces %}
      - name: {{ interface.name }}
        macAddress: {{ interface.mac_address }}
{% endfor %}
{% if node.rootDeviceHints is defined %}
    rootDeviceHints:
{% if node.rootDeviceHints.deviceName is defined %}
      deviceName: {{ node.rootDeviceHints.deviceName }}
{% endif %}
{% if node.rootDeviceHints.wwn is defined %}
      wwn: "{{ node.rootDeviceHints.wwn }}"
{% endif %}
{% if node.rootDeviceHints.vendor is defined %}
      vendor: {{ node.rootDeviceHints.vendor }}
{% endif %}
{% if node.rootDeviceHints.model is defined %}
      model: {{ node.rootDeviceHints.model }}
{% endif %}
{% if node.rootDeviceHints.serialNumber is defined %}
      serialNumber: {{ node.rootDeviceHints.serialNumber }}
{% endif %}
{% if node.rootDeviceHints.minSizeGigabytes is defined %}
      minSizeGigabytes: {{ node.rootDeviceHints.minSizeGigabytes }}
{% endif %}
{% if node.rootDeviceHints.hctl is defined %}
      hctl: {{ node.rootDeviceHints.hctl }}
{% endif %}
{% if node.rootDeviceHints.rotational is defined %}
      rotational: {{ node.rootDeviceHints.rotational }}
{% endif %}
{% endif %}
    networkConfig:
      interfaces:
{% for interface in node.networkConfig.interfaces %}
        - {{ interface | to_nice_yaml | indent(10) }}
{% endfor %}
      dns-resolver:
        config:
{% if dns_servers is defined %}
          server:
{% for server in dns_servers %}
            - {{ server }}
{% endfor %}
{% endif %}
{% if dns_search_domains is defined %}
          search:
{% for server in dns_search_domains %}
            - {{ server }}
{% endfor %}
{% endif %}
{% if node.networkConfig.routes is defined %}
      routes:
        config:
{% for route in node.networkConfig.routes.config %}
        - {{ route | to_nice_yaml | indent(10) }}
{% endfor %}
{% endif %}
{% endfor %}
